<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Firebase Chat App</title>
<style>
    body { font-family: Arial; text-align:center; margin-top:50px; }
    #chatBox { display:none; border:1px solid #ccc; padding:20px; max-width:500px; margin:auto; }
    #messages { border:1px solid #ddd; height:300px; overflow-y:scroll; margin-bottom:10px; padding:5px; text-align:left;}
    input { padding:5px; margin:5px; width:80%; }
    button { padding:5px 10px; margin:5px; }
</style>
</head>
<body>

<h2>Login / Create Account</h2>
<div id="authBox">
    <input type="email" id="email" placeholder="Email"><br>
    <input type="password" id="password" placeholder="Password"><br>
    <button onclick="signup()">Create Account</button>
    <button onclick="login()">Login</button>
    <p id="authMsg" style="color:red;"></p>
</div>

<div id="chatBox">
    <h3>Welcome <span id="userEmail"></span></h3>
    <div id="messages"></div>
    <input type="text" id="msgInput" placeholder="Type a message">
    <button onclick="sendMessage()">Send</button>
    <button onclick="logout()">Logout</button>
</div>

<!-- Firebase SDK -->
<script type="module">
  // Import Firebase modules
  import { initializeApp } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-app.js";
  import { getAuth, createUserWithEmailAndPassword, signInWithEmailAndPassword, signOut } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-auth.js";
  import { getDatabase, ref, push, onChildAdded } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-database.js";

  // Firebase config (replace with your own)
  const firebaseConfig = {
    apiKey: "AIzaSyDs-Abc-30nWgPE00AQq2jvWC5NFrzYVyA",
    authDomain: "fir-call-app-f20bd.firebaseapp.com",
    databaseURL: "https://fir-call-app-f20bd-default-rtdb.firebaseio.com",
    projectId: "fir-call-app-f20bd",
    storageBucket: "fir-call-app-f20bd.appspot.com",
    messagingSenderId: "953173074341",
    appId: "1:953173074341:web:d354fb166982116847c84c"
  };

  // Initialize Firebase
  const app = initializeApp(firebaseConfig);
  const auth = getAuth(app);
  const db = getDatabase(app);

  const emailInput = document.getElementById('email');
  const passwordInput = document.getElementById('password');
  const authMsg = document.getElementById('authMsg');
  const chatBox = document.getElementById('chatBox');
  const authBox = document.getElementById('authBox');
  const userEmailSpan = document.getElementById('userEmail');
  const msgInput = document.getElementById('msgInput');
  const messagesDiv = document.getElementById('messages');

  // Signup function
  window.signup = function() {
    const email = emailInput.value;
    const password = passwordInput.value;
    createUserWithEmailAndPassword(auth, email, password)
      .then((userCredential) => {
        authMsg.style.color = "green";
        authMsg.textContent = "Account created!";
      })
      .catch((error) => {
        authMsg.style.color = "red";
        authMsg.textContent = error.message;
      });
  }

  // Login function
  window.login = function() {
    const email = emailInput.value;
    const password = passwordInput.value;
    signInWithEmailAndPassword(auth, email, password)
      .then((userCredential) => {
        authBox.style.display = 'none';
        chatBox.style.display = 'block';
        userEmailSpan.textContent = email;
        loadMessages();
      })
      .catch((error) => {
        authMsg.style.color = "red";
        authMsg.textContent = error.message;
      });
  }

  // Logout function
  window.logout = function() {
    signOut(auth).then(() => {
      chatBox.style.display = 'none';
      authBox.style.display = 'block';
      messagesDiv.innerHTML = '';
      msgInput.value = '';
      emailInput.value = '';
      passwordInput.value = '';
      authMsg.textContent = '';
    });
  }

  // Send message
  window.sendMessage = function() {
    const msg = msgInput.value.trim();
    const user = auth.currentUser;
    if (!msg || !user) return;

    push(ref(db, 'messages'), {
      user: user.email,
      message: msg
    });
    msgInput.value = '';
  }

  // Load messages in real-time
  function loadMessages() {
    const messagesRef = ref(db, 'messages');
    onChildAdded(messagesRef, (snapshot) => {
      const data = snapshot.val();
      const msgElement = document.createElement('p');
      msgElement.textContent = `${data.user}: ${data.message}`;
      messagesDiv.appendChild(msgElement);
      messagesDiv.scrollTop = messagesDiv.scrollHeight;
    });
  }
</script>

</body>
</html>
